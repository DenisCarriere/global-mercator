!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):r.mercator=e()}(this,function(){function r(r){return r=r||256,2*Math.PI*6378137/r}function e(r){var e=r[0],t=r[1],n=r[2];return(1<<n)*((1<<n)+e)+t}function t(r){var e=r[0],t=r[1],n=r[2],o=r[3],i=(e-n)/2+n,u=(t-o)/2+o;return i=Number(i.toFixed(6)),u=Number(u.toFixed(6)),[i,u]}function n(r,e){r=E(r,e);var t=r[0],n=r[1],o=t*N/180,i=Math.log(Math.tan((90+n)*Math.PI/360))/(Math.PI/180);return i=i*N/180,o=Number(o.toFixed(1)),i=Number(i.toFixed(1)),[o,i]}function o(r){var e=r[0],t=r[1],n=e/N*180,o=t/N*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),n=Number(n.toFixed(6)),o=Number(o.toFixed(6)),[n,o]}function i(r,e,t){var n=r[0],o=r[1],i=B(e,t);return[(n+N)/i,(o+N)/i,e]}function u(r,e,t){return r=E(r,t),c(i(n(r),e))}function a(r,e,t){return r=E(r,t),0===e?[0,0,0]:w(u(r,e))}function f(r,e){return 0===e?[0,0,0]:c(i(r,e))}function l(r,e){var t=r[0],n=r[1],o=r[2],i=B(o,e),u=t*i-N,a=n*i-N;return u=Number(u.toFixed(1)),a=Number(a.toFixed(1)),[u,a]}function c(r,e,t){e=e||256;var n=r[0],o=r[1],i=r[2];if(0===i)return[0,0,0];y(i);var u=Math.ceil(n/e)-1,a=Math.ceil(o/e)-1;return u<0&&(u=0),a<0&&(a=0),[u,a,i]}function h(r,e,t){p(r,t),e=e||256;var n=r[0],o=r[1],i=r[2],u=l([n*e,o*e,i]),a=l([(n+1)*e,(o+1)*e,i]);return[u[0],u[1],a[0],a[1]]}function d(r,e){p(r,e);var t=r[0],n=r[1],i=r[2];if(0===i)return[-180,-85.051129,180,85.051129];var u=h([t,n,i]),a=u[0],f=u[1],l=u[2],c=u[3],d=o([a,f,i]),s=o([l,c,i]);return[d[0],d[1],s[0],s[1]]}function s(r){return h(m(r))}function v(r){return d(m(r))}function w(r,e){p(r,e);var t=r[0],n=r[1],o=r[2];return 0===o?[0,0,0]:[t,Math.pow(2,o)-1-n,o]}function m(r){var e=r[0],t=r[1],n=r[2];return[e,Math.pow(2,n)-t-1,n]}function T(r){return g(m(r))}function g(r,e){p(r,e);var t=r[0],n=r[1],o=r[2];if(0===o)return"";var i="";return n=Math.pow(2,o)-1-n,I(o,0,-1).map(function(r){var e=0,o=1<<r-1;0!=(t&o)&&(e+=1),0!=(n&o)&&(e+=2),i=i.concat(e)}),i}function x(r){return m(M(r))}function M(r){var e=0,t=0,n=r.length;return I(n,0,-1).map(function(o){var i=1<<o-1;switch(parseInt(r[n-o],0)){case 0:break;case 1:e+=i;break;case 2:t+=i;break;case 3:e+=i,t+=i;break;default:throw new Error("Invalid Quadkey digit sequence")}}),[e,t,n]}function b(r){var e=n([r[0],r[1]]),t=n([r[2],r[3]]);return[e[0],e[1],t[0],t[1]]}function p(r,e){var t=r[0],n=r[1],o=r[2];if(e===!1)return r;if(y(o),void 0===t||null===t)throw new Error("<x> is required");if(void 0===n||null===n)throw new Error("<y> is required");if(t<0)throw new Error("<x> must not be less than 0");if(n<0)throw new Error("<y> must not be less than 0");var i=Math.pow(2,o);if(t>=i||n>=i)throw new Error("Illegal parameters for tile");return r}function y(r){if(r===!1)return r;if(void 0===r||null===r)throw new Error("<zoom> is required");if(r<0)throw new Error("<zoom> cannot be less than 0");if(r>30)throw new Error("<zoom> cannot be greater than 30");return r}function E(r,e){if(e===!1)return r;var t=F(r[0]),n=q(r[1]);return n>85&&(n=85),t<-85&&(n=-85),[t,n]}function B(e,t){return r(t)/Math.pow(2,e)}function I(r,e,t){null==e&&(e=r||0,r=0),t||(t=e<r?-1:1);for(var n=Math.max(Math.ceil((e-r)/t),0),o=Array(n),i=0;i<n;i++,r+=t)o[i]=r;return o}function k(r){if(r&&r[0]&&4===r.length&&void 0===r[0][0])return r;if(r&&r[0]&&void 0!==r[0][0]){var e=r[0][0],t=r[0][1],n=r[0][2],o=r[0][3];return r.map(function(r){r[0]<e&&(e=r[0]),r[1]<t&&(t=r[1]),r[2]>n&&(n=r[2]),r[3]>o&&(o=r[3])}),[e,t,n,o]}}function q(r){if(!r)throw new Error("lat is required");return(r>90||r<-90)&&(r%=180,r>90&&(r=-180+r),r<-90&&(r=180+r),r===-0&&(r=0)),r}function F(r){if(!r)throw new Error("lng is required");return(r>180||r<-180)&&(r%=360,r>180&&(r=-360+r),r<-180&&(r=360+r),r===-0&&(r=0)),r}var N=2*Math.PI*6378137/2;return{hash:e,bboxToCenter:t,lngLatToMeters:n,metersToLngLat:o,metersToPixels:i,lngLatToTile:u,lngLatToGoogle:a,metersToTile:f,pixelsToMeters:l,pixelsToTile:c,tileToBBoxMeters:h,tileToBBox:d,googleToBBoxMeters:s,googleToBBox:v,tileToGoogle:w,googleToTile:m,googleToQuadkey:T,tileToQuadkey:g,quadkeyToTile:x,quadkeyToGoogle:M,bboxToMeters:b,validateTile:p,validateZoom:y,validateLngLat:E,resolution:B,range:I,maxBBox:k,latitude:q,longitude:F}});
